DROP DATABASE IF EXISTS papyrus4;
CREATE DATABASE papyrus4;
USE papyrus4;

CREATE TABLE produit (

CODART      CHAR(4) NOT NULL PRIMARY KEY,
LIBART      VARCHAR(30) NOT NULL,
STKALE      INT(10) NOT NULL,
STKPHY      INT(10) NOT NULL,
QTEANN      INT(10) NOT NULL,
UNIMES      CHAR(5) NOT NULL

);

CREATE TABLE fournis (

NUMFOU      VARCHAR(25) NOT NULL PRIMARY KEY,
NOMFOU      VARCHAR(25) NOT NULL,
RUEFOU      VARCHAR(50) NOT NULL,
POSFOU      CHAR(5) NOT NULL,
VILFOU      VARCHAR(30) NOT NULL,
CONFOU      VARCHAR(15) NOT NULL,
SATISF      TINYINT(2)

);

CREATE TABLE vente (

DELLIV      SMALLINT(5) NOT NULL,
QTE1        INT(10) NOT NULL,
PRIX1       VARCHAR(50) NOT NULL,
QTE2        INT(10),
PRIX2       VARCHAR(50),
QTE3        INT(10),
PRIX3       VARCHAR(50),
NUMFOU      VARCHAR(25) NOT NULL,
CODART      CHAR(4) NOT NULL,
PRIMARY KEY (NUMFOU, CODART),
FOREIGN KEY (NUMFOU) REFERENCES fournis(NUMFOU),
FOREIGN KEY (CODART) REFERENCES produit(CODART)

);

CREATE TABLE entcom (

NUMCOM      INT(10) NOT NULL AUTO_INCREMENT PRIMARY KEY,
OBSCOM      VARCHAR(50),
DATCOM      DATETIME NOT NULL,
NUMFOU      VARCHAR(25),
FOREIGN KEY (NUMFOU) REFERENCES fournis(NUMFOU)

);

CREATE INDEX NUMFOUIND ON entcom(NUMFOU);

CREATE TABLE ligcom (

NUMLIG      TINYINT(3) NOT NULL PRIMARY KEY,
QTECDE      INT(10) NOT NULL,
PRIUNI      VARCHAR(50) NOT NULL,
QTELIV      INT(10),
DERLIV      DATETIME NOT NULL,
NUMCOM      INT(10) NOT NULL,
CODART      CHAR(4) NOT NULL,
FOREIGN KEY (NUMCOM) REFERENCES entcom(NUMCOM),
FOREIGN KEY (CODART) REFERENCES produit(CODART)

);

CREATE USER 'util1'@'%' IDENTIFIED BY 'test1';
CREATE USER 'util2'@'%' IDENTIFIED BY 'test2';
CREATE USER 'util3'@'%' IDENTIFIED BY 'test3';

GRANT ALL PRIVILEGES
ON papyrus4.*
TO 'util1'@'%';

GRANT SELECT
ON papyrus4.*
TO 'util2'@'%';

GRANT SELECT
ON papyrus4.fournis
TO 'util3'@'%';
